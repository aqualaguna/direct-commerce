{
  "kind": "collectionType",
  "collectionName": "order_status_updates",
  "info": {
    "singularName": "order-status-update",
    "pluralName": "order-status-updates",
    "displayName": "Order Status Update",
    "description": "Order status update records for tracking order lifecycle changes"
  },
  "options": {
    "draftAndPublish": false
  },
  "pluginOptions": {},
  "attributes": {
    "orderId": {
      "type": "string",
      "description": "Order ID reference (will be replaced with relation when order API is implemented in Story 4.4)"
    },
    "previousStatus": {
      "type": "string",
      "required": true,
      "description": "Previous order status"
    },
    "newStatus": {
      "type": "string",
      "required": true,
      "description": "New order status"
    },
    "triggeredBy": {
      "type": "enumeration",
      "enum": [
        "payment_confirmation",
        "manual_update",
        "system",
        "customer_request",
        "admin_action",
        "automated_rule"
      ],
      "required": true,
      "default": "manual_update"
    },
    "paymentConfirmation": {
      "type": "relation",
      "relation": "oneToOne",
      "target": "api::payment-confirmation.payment-confirmation",
      "mappedBy": "orderStatusUpdate"
    },
    "updatedBy": {
      "type": "relation",
      "relation": "manyToOne",
      "target": "plugin::users-permissions.user",
      "required": true
    },
    "updateNotes": {
      "type": "text",
      "description": "Notes about the status update"
    },
    "updateReason": {
      "type": "enumeration",
      "enum": [
        "payment_received",
        "payment_confirmed",
        "payment_failed",
        "order_cancelled",
        "order_refunded",
        "shipping_updated",
        "customer_request",
        "system_automation",
        "admin_decision",
        "fraud_detection",
        "inventory_issue",
        "other"
      ],
      "description": "Reason for the status update"
    },
    "automationRule": {
      "type": "string",
      "description": "Name of automation rule that triggered the update"
    },
    "metadata": {
      "type": "json",
      "description": "Additional metadata about the status update"
    },
    "notificationSent": {
      "type": "boolean",
      "default": false,
      "description": "Whether notification was sent for this status update"
    },
    "notificationChannels": {
      "type": "json",
      "description": "Channels through which notification was sent"
    },
    "estimatedDeliveryDate": {
      "type": "date",
      "description": "Estimated delivery date after status update"
    },
    "actualDeliveryDate": {
      "type": "date",
      "description": "Actual delivery date if applicable"
    },
    "statusUpdateHistory": {
      "type": "json",
      "description": "History of status changes for this order"
    }
  }
}
